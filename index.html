<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Orbit Promo Page ‚Äì Generator & Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
    }
    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      min-height: 100vh;
      align-items: stretch;
      justify-content: center;
    }
    .wrapper {
      max-width: 1100px;
      width: 100%;
      margin: 1.5rem;
      background: #020617;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: row;
    }
    @media (max-width: 800px) {
      .wrapper {
        flex-direction: column;
      }
    }
    .panel {
      padding: 1.5rem;
      flex: 1;
      overflow: auto;
    }
    .panel.generator {
      background: radial-gradient(circle at top left, #1d4ed8, #020617 55%);
      border-right: 1px solid rgba(148,163,184,0.2);
    }
    .panel.promo {
      background: #020617;
    }
    h1, h2, h3 {
      margin-top: 0;
      color: #f9fafb;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(148,163,184,0.4);
      color: #cbd5f5;
    }
    .badge span {
      font-size: 0.9rem;
    }
    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
      color: #e5e7eb;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.75);
      color: #f9fafb;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 160px;
    }
    input::placeholder, textarea::placeholder {
      color: #9ca3af;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.75rem;
    }
    .field {
      margin-bottom: 0.75rem;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 0.6rem 1.4rem;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      background: #22c55e;
      color: #022c22;
      box-shadow: 0 10px 30px rgba(34,197,94,0.4);
    }
    button.secondary {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: none;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(34,197,94,0.35);
    }
    small {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .output {
      margin-top: 0.75rem;
      font-size: 0.8rem;
    }
    .output textarea {
      font-size: 0.75rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      min-height: 60px;
    }
    .qrcode-box {
      margin-top: 0.75rem;
      padding: 0.75rem;
      border-radius: 0.75rem;
      border: 1px dashed rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.8);
      text-align: center;
    }
    .promo-shell {
      border-radius: 1rem;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.4);
      background: #020617;
    }
    .promo-hero {
      position: relative;
      padding: 1.25rem;
      min-height: 180px;
      display: flex;
      align-items: flex-end;
      color: white;
      background: radial-gradient(circle at top, #1e293b, #020617);
      overflow: hidden;
    }
    .promo-hero-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      filter: brightness(0.6);
      opacity: 0.8;
    }
    .promo-hero-overlay {
      position: relative;
      z-index: 1;
    }
    .promo-hero h2 {
      margin: 0 0 0.15rem;
      font-size: 1.4rem;
    }
    .promo-hero p {
      margin: 0;
      font-size: 0.85rem;
      color: #e5e7eb;
    }
    .promo-country {
      font-size: 0.75rem;
      opacity: 0.9;
    }
    .promo-body {
      padding: 1rem 1.25rem 0.75rem;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 1rem;
    }
    @media (max-width: 700px) {
      .promo-body {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .promo-main {
      font-size: 0.9rem;
      color: #e5e7eb;
    }
    .promo-main h3 {
      margin-top: 0;
      font-size: 1rem;
    }
    .promo-contact {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    .promo-contact div {
      margin-bottom: 0.15rem;
    }
    .promo-promo-box {
      border-radius: 0.75rem;
      padding: 0.65rem;
      border: 1px solid rgba(248,250,252,0.2);
      background: radial-gradient(circle at top left, rgba(34,197,94,0.16), rgba(15,23,42,0.9));
      font-size: 0.85rem;
    }
    .promo-promo-box strong {
      display: block;
      margin-bottom: 0.25rem;
      color: #bbf7d0;
    }
    .promo-image {
      margin-top: 0.5rem;
      border-radius: 0.5rem;
      overflow: hidden;
      max-height: 180px;
    }
    .promo-image img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .promo-logo-box {
      text-align: center;
      font-size: 0.8rem;
    }
    .promo-logo {
      margin-bottom: 0.4rem;
      border-radius: 0.75rem;
      overflow: hidden;
      max-height: 100px;
      display: inline-block;
      border: 1px solid rgba(148,163,184,0.5);
    }
    .promo-logo img {
      display: block;
      width: 180px;
      height: 100px;
      object-fit: cover;
    }
    .cta-btn {
      margin-top: 0.6rem;
      width: 100%;
      justify-content: center;
      font-size: 0.9rem;
      background: linear-gradient(to right, #22c55e, #16a34a);
      color: #022c22;
    }
    .promo-footer {
      border-top: 1px solid rgba(30,64,175,0.7);
      padding: 0.6rem 1.25rem 0.75rem;
      font-size: 0.75rem;
      color: #9ca3af;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 0.5rem;
      background: radial-gradient(circle at bottom, rgba(30,64,175,0.25), #020617);
    }
    .expired {
      text-align: center;
      padding: 2rem 1rem;
    }
    .expired h2 {
      color: #fecaca;
    }
    .expired p {
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    .chip {
      display: inline-flex;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(248,250,252,0.3);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.35rem;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- Generator Panel -->
    <div class="panel generator" id="generatorPanel">
      <div class="badge">
        <span>‚öôÔ∏è</span> <span>Orbit Promo Generator</span>
      </div>
      <h1>7-Day Promo Page</h1>
      <p style="font-size:0.9rem;max-width:34rem;">
        Create a temporary 1-page website for any business. After <strong>7 days</strong> the page auto-expires
        and invites the owner to <strong>upgrade to DS360</strong> or <strong>buy a 1-year Orbit URL</strong>.
      </p>

      <form id="promoForm" onsubmit="event.preventDefault(); generatePromo();">
        <div class="field">
          <label for="promoterEmail">Promoter email (footer credit)</label>
          <input type="email" id="promoterEmail" placeholder="promoter@example.com" required />
        </div>

        <div class="grid">
          <div class="field">
            <label for="bizName">Business name</label>
            <input type="text" id="bizName" placeholder="Thando Fresh Market" required />
          </div>
          <div class="field">
            <label for="country">Country</label>
            <select id="country">
              <option value="South Africa">South Africa</option>
              <option value="United States">United States</option>
              <option value="">Other</option>
            </select>
          </div>
        </div>

        <div class="grid">
          <div class="field">
            <label for="address">Address</label>
            <input type="text" id="address" placeholder="28 Vilakazi Street, Soweto" />
          </div>
          <div class="field">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" placeholder="+27 61 582 1149" />
          </div>
        </div>

        <div class="field">
          <label for="email">Business email</label>
          <input type="email" id="email" placeholder="thandofreshmarket@gmail.com" />
        </div>

        <div class="field">
          <label for="profile">Short profile</label>
          <textarea id="profile" maxlength="300"
            placeholder="Local family-owned fresh produce shop."></textarea>
          <small>Max 300 characters.</small>
        </div>

        <div class="field">
          <label for="promoText">Promo text (what the client gets)</label>
          <textarea id="promoText" maxlength="500"
            placeholder="Buy 2kg potatoes + get 1kg free!"></textarea>
          <small>Max 500 characters.</small>
        </div>

        <div class="grid">
          <div class="field">
            <label for="startDate">Start date</label>
            <input type="date" id="startDate" required />
          </div>
          <div class="field">
            <label for="endDate">End date</label>
            <input type="date" id="endDate" required />
            <small>Default is start date + 7 days.</small>
          </div>
        </div>

        <div class="field">
          <label>Image URLs (online)</label>
          <small>Upload images to Amawebs / DS360 / Imgur / etc. and paste the links.</small>
        </div>

        <div class="field">
          <label for="bgUrl">Background image URL (any size)</label>
          <input type="text" id="bgUrl" placeholder="https://example.com/background.jpg" />
        </div>

        <div class="grid">
          <div class="field">
            <label for="promoImgUrl">Promo image URL (‚âà 500√ó250)</label>
            <input type="text" id="promoImgUrl" placeholder="https://example.com/promo.jpg" />
          </div>
          <div class="field">
            <label for="logoUrl">Logo / owner photo URL (‚âà 500√ó250)</label>
            <input type="text" id="logoUrl" placeholder="https://example.com/logo.jpg" />
          </div>
        </div>

        <div class="field">
          <label for="ctaChannel">Client contact channel</label>
          <select id="ctaChannel">
            <option value="whatsapp">WhatsApp</option>
            <option value="phone">Phone call</option>
            <option value="none">No direct contact, just info</option>
          </select>
          <small>For WhatsApp, clients click the button to send a pre-filled message.</small>
        </div>

        <div class="field">
          <button type="submit">
            üöÄ Generate link & QR
          </button>
        </div>

        <div class="output">
          <label for="promoUrl">Promo URL (share with owner / make QR)</label>
          <textarea id="promoUrl" readonly></textarea>
        </div>

        <div class="qrcode-box">
          <div id="qrcode"></div>
          <small>Scan to test the 7-day promo page. You can screenshot this QR for print.</small>
        </div>
      </form>
    </div>

    <!-- Promo Display Panel -->
    <div class="panel promo" id="promoPanel">
      <div id="promoContent">
        <!-- Filled by JS -->
      </div>
    </div>
  </div>

  <!-- QRCode library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    function formatDatePretty(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T12:00:00");
      if (isNaN(d.getTime())) return dateStr;
      return d.toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric"
      });
    }

    function todayISO() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function addDaysISO(startStr, days) {
      const d = new Date(startStr + "T12:00:00");
      if (isNaN(d.getTime())) return startStr;
      d.setDate(d.getDate() + days);
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function initFormDefaults() {
      const start = document.getElementById("startDate");
      const end = document.getElementById("endDate");
      const today = todayISO();
      if (!start.value) start.value = today;
      if (!end.value) end.value = addDaysISO(today, 7);
    }

    function generatePromo() {
      const promoter = document.getElementById("promoterEmail").value.trim();
      const biz = document.getElementById("bizName").value.trim();
      const country = document.getElementById("country").value.trim();
      const address = document.getElementById("address").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const profile = document.getElementById("profile").value.trim();
      const promoText = document.getElementById("promoText").value.trim();
      const start = document.getElementById("startDate").value;
      const end = document.getElementById("endDate").value;
      const bgUrl = document.getElementById("bgUrl").value.trim();
      const promoImg = document.getElementById("promoImgUrl").value.trim();
      const logoUrl = document.getElementById("logoUrl").value.trim();
      const ctaChannel = document.getElementById("ctaChannel").value;

      const params = new URLSearchParams();
      params.set("mode", "promo");
      if (promoter) params.set("promoter", promoter);
      if (biz) params.set("biz", biz);
      if (country) params.set("country", country);
      if (address) params.set("addr", address);
      if (phone) params.set("phone", phone);
      if (email) params.set("mail", email);
      if (profile) params.set("profile", profile);
      if (promoText) params.set("promo", promoText);
      if (start) params.set("start", start);
      if (end) params.set("end", end);
      if (bgUrl) params.set("bg", bgUrl);
      if (promoImg) params.set("promoImg", promoImg);
      if (logoUrl) params.set("logo", logoUrl);
      if (ctaChannel) params.set("cta", ctaChannel);

      const baseUrl = window.location.origin + window.location.pathname;
      const url = baseUrl + "?" + params.toString();

      const out = document.getElementById("promoUrl");
      out.value = url;

      const qrBox = document.getElementById("qrcode");
      qrBox.innerHTML = "";
      new QRCode(qrBox, {
        text: url,
        width: 160,
        height: 160
      });

      // Also render preview on the right
      renderPromoFromParams(params);
    }

    function renderPromoFromParams(params) {
      const container = document.getElementById("promoContent");
      const biz = params.get("biz") || "Your Business Name";
      const country = params.get("country") || "";
      const addr = params.get("addr") || "";
      const phone = params.get("phone") || "";
      const mail = params.get("mail") || "";
      const profile = params.get("profile") || "";
      const promo = params.get("promo") || "Your special offer goes here.";
      const start = params.get("start");
      const end = params.get("end");
      const bg = params.get("bg") || "";
      const promoImg = params.get("promoImg") || "";
      const logo = params.get("logo") || "";
      const promoter = params.get("promoter") || "";
      const cta = params.get("cta") || "whatsapp";

      // Expiry check
      let expired = false;
      if (end) {
        const now = new Date();
        const endDate = new Date(end + "T23:59:59");
        if (!isNaN(endDate.getTime()) && now > endDate) {
          expired = true;
        }
      }

      if (expired) {
        container.innerHTML = `
          <div class="promo-shell">
            <div class="expired">
              <div class="chip">Promo expired</div>
              <h2>This promotion is no longer active.</h2>
              <p>
                The 7-day promo page for <strong>${biz}</strong> has expired.
                Please contact the promoter${promoter ? ` <strong>${promoter}</strong>` : ""} 
                to renew for 1 year or upgrade to <strong>DS360</strong>.
              </p>
            </div>
            <div class="promo-footer">
              <div>
                Created with <strong>Orbit Promo</strong> ¬∑ Temporary digital presence tool.
              </div>
              <div>
                ${promoter ? `Promoter: ${promoter}` : ""} 
              </div>
            </div>
          </div>
        `;
        return;
      }

      let ctaButton = "";
      if (cta === "whatsapp" && phone) {
        const wa = "https://wa.me/" + phone.replace(/[^0-9]/g, "");
        const msg = encodeURIComponent("Hi, I saw your promo and would like to benefit from the offer.");
        ctaButton = `
          <a href="${wa}?text=${msg}" target="_blank" rel="noopener">
            <button class="cta-btn">üì≤ Claim this offer via WhatsApp</button>
          </a>
        `;
      } else if (cta === "phone" && phone) {
        ctaButton = `
          <a href="tel:${phone.replace(/\s+/g,"")}">
            <button class="cta-btn">üìû Call now to claim this offer</button>
          </a>
        `;
      }

      const datesLine = (start || end)
        ? `<div class="promo-contact">
             ${start ? `Starts: ${formatDatePretty(start)} ¬∑ ` : ""}
             ${end ? `Valid until: ${formatDatePretty(end)}` : ""}
           </div>`
        : "";

      container.innerHTML = `
        <div class="promo-shell">
          <div class="promo-hero">
            ${bg ? `<div class="promo-hero-bg" style="background-image:url('${bg}');"></div>` : ""}
            <div class="promo-hero-overlay">
              <div class="chip">Limited-time offer</div>
              <h2>${biz}</h2>
              <p class="promo-country">${country || ""}</p>
              ${addr ? `<p>${addr}</p>` : ""}
            </div>
          </div>
          <div class="promo-body">
            <div class="promo-main">
              ${profile ? `<p>${profile}</p>` : ""}
              <div class="promo-contact">
                ${phone ? `<div>üìû ${phone}</div>` : ""}
                ${mail ? `<div>üìß ${mail}</div>` : ""}
              </div>
              ${datesLine}
              <div style="margin-top:0.75rem;">
                ${ctaButton || ""}
              </div>
            </div>
            <div>
              <div class="promo-promo-box">
                <strong>üî• Promo</strong>
                <div>${promo}</div>
                ${promoImg ? `
                  <div class="promo-image">
                    <img src="${promoImg}" alt="Promo image">
                  </div>` : ""}
              </div>
              <div class="promo-logo-box" style="margin-top:0.75rem;">
                ${logo ? `
                  <div class="promo-logo">
                    <img src="${logo}" alt="Logo">
                  </div>` : ""}
                <div>Show this page in-store to benefit from the promo.</div>
              </div>
            </div>
          </div>
          <div class="promo-footer">
            <div>
              Temporary page created via promoter ${promoter ? `<strong>${promoter}</strong>` : ""}.
              ${end ? ` Valid until ${formatDatePretty(end)}.` : ""}
            </div>
            <div>
              After this date: contact promoter to upgrade to <strong>DS360</strong> or get a 1-year Orbit URL.
            </div>
          </div>
        </div>
      `;
    }

    function initFromUrl() {
  const params = new URLSearchParams(window.location.search);
  const mode = params.get("mode");
  const generatorPanel = document.getElementById("generatorPanel");
  const wrapper = document.querySelector(".wrapper");

  if (mode === "promo" && params.get("biz")) {
    // HIDE the form when we are in promo mode
    if (generatorPanel) {
      generatorPanel.style.display = "none";
    }
    if (wrapper) {
      wrapper.style.maxWidth = "700px"; // promo page centered, narrower
    }
    renderPromoFromParams(params);
  } else {
    // No promo parameters, show demo on the right + form on the left
    const demoParams = new URLSearchParams();
    demoParams.set("biz", "Thando Fresh Market");
    demoParams.set("country", "South Africa");
    demoParams.set("addr", "28 Vilakazi Street, Soweto");
    demoParams.set("phone", "+27 61 582 1149");
    demoParams.set("mail", "thandofreshmarket@gmail.com");
    demoParams.set("profile", "Local family-owned fresh produce shop with fresh fruit & vegetables daily.");
    demoParams.set("promo", "Buy 2kg potatoes + get 1kg free! Only this week.");
    const today = todayISO();
    demoParams.set("start", today);
    demoParams.set("end", addDaysISO(today, 7));
    demoParams.set("promoter", "irving@billigue.com");
    demoParams.set("cta", "whatsapp");
    renderPromoFromParams(demoParams);
  }
  initFormDefaults();
}


    window.addEventListener("DOMContentLoaded", initFromUrl);
  </script>
</body>
</html>
